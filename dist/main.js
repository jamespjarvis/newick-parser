window.Tree=function(t){var e={};function s(i){if(e[i])return e[i].exports;var h=e[i]={i:i,l:!1,exports:{}};return t[i].call(h.exports,h,h.exports,s),h.l=!0,h.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)s.d(i,h,function(e){return t[e]}.bind(null,h));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);var i=class{constructor(){this.tree=null,this.id="",this.label=null,this.angle=0,this.children=[],this.minX=0,this.maxX=0,this.minY=0,this.maxY=0,this.centerX=0,this.centerY=0,this.startX=0,this.startY=0,this.parent=null,this.length=0,this.totalLength=0,this.totalChildren=0,this.leaf=!0,this.radius=1}getRadius(){return this.leaf?this.tree.baseNodeSize*this.radius:this.tree.baseNodeSize/this.radius}getTotalLength(){return this.tree.ctx.font="20pt sans-serif",3*this.getRadius()+this.tree.ctx.measureText(this.label).width}drawNode(){const t=this.getRadius(),e=t,s=this.leaf?e*Math.cos(this.angle)+this.centerX:this.centerX,i=this.leaf?e*Math.sin(this.angle)+this.centerY:this.centerY;this.setDimensions(s,i,t),this.leaf&&(this.tree.ctx.save(),this.tree.ctx.translate(this.centerX,this.centerY),this.tree.ctx.rotate(this.angle),this.drawLeaf(),this.drawLabel(),this.tree.ctx.restore())}drawLeaf(){this.drawLabelConnector();const t=Math.pow(this.getRadius()*Math.sqrt(2),2),e=Math.sqrt(t/Math.PI),s=this.tree.ctx;s.beginPath(),s.arc(this.getRadius(),0,e,2*Math.PI,!1),s.fill(),s.stroke(),s.closePath()}setDimensions(t,e,s){const i=s*this.tree.zoom<5||!this.leaf?5/this.tree.zoom:s;this.minX=t-i,this.maxX=t+i,this.minY=e-i,this.maxY=e+i}getBounds(){const t=this.getRadius(),e=this.getTotalLength(),s=this.centerX-t,i=this.centerY-t,h=this.centerX+e*Math.cos(this.angle),n=this.centerY+e*Math.sin(this.angle),r=this.tree.getStep()/2;return console.log(this.centerX),{minX:Math.min(s,h,this.centerX-r),minY:Math.min(i,n,this.centerY-r),maxX:Math.max(s,h,this.centerX+r),maxY:Math.max(i,n,this.centerY+r)}}drawLabel(){const t=this.label||"";this.tree.ctx.font="20pt sans-serif",this.labelWidth=this.tree.ctx.measureText(t).width;const e=2*this.getRadius(),s=Math.abs(this.tree.farthestNodeFromRootX-this.centerX);this.tree.ctx.beginPath(),this.tree.ctx.fillText(t.toUpperCase(),e+s+25,10),this.tree.ctx.closePath()}drawLabelConnector(){const t=this.tree.ctx;t.save(),t.lineWidth=t.lineWidth/4,t.strokeStyle="#add8e6",t.beginPath(),t.moveTo(this.getRadius(),0),t.lineTo(Math.abs(this.tree.farthestNodeFromRootX-this.centerX)+2*this.getRadius(),0),t.stroke(),t.closePath(),t.restore()}addChild(t){t.parent=this,t.tree=this.tree,this.leaf=!1,this.children.push(t)}storeChildren(){for(let t of this.children)this.tree.storeNode(t),t.storeChildren()}static generateId(){return`${this.lastId++}`}setTotalLength(){this.parent?(this.totalLength=this.parent.totalLength+this.length,this.totalLength>this.tree.maxBranchLength&&(this.tree.maxBranchLength=this.totalLength)):(this.totalLength=this.length,this.tree.maxBranchLength=this.totalLength),this.children.forEach(t=>t.setTotalLength())}};function h(t){return this===t}const n=[":",",",")",";"];function r(t){let e="";for(let s of t){if(n.some(h.bind(s)))break;e+=s}return e}const a=[")",",",";"];function o(t,e,s){let n=r(e.slice(s)),o=s+n.length,c="";return n.match(/\*/)&&function(t,e){let s=t.split("**"),i={};if(e.id=s[0],1!==s.length){s=s[1].split("*");for(let t=0;t<s.length;t+=2){let e=s[t+1];switch(s[t]){case"nsz":i.size=window.parseInt(e);break;case"nsh":i.shape=e;break;case"ncol":i.colour=e}}e.setDisplay(i)}}(n,t),":"===e[o]?(c=function(t){let e="";for(let s of t){if(a.some(h.bind(s)))break;e+=s}return e}(e.slice(o+1)),t.length=Math.max(parseFloat(c),0)):t.length=0,n&&(t.label=n),t.id=n||i.generateId(),o+c.length}var c={parseFunction(t,e){const s=t.replace(/(\r|\n|\s)/g,"");let h=e;for(let e=0;e<s.length;e++){let n;switch(s[e]){case"(":n=new i,h.addChild(n),h=n;break;case")":h=h.parent;break;case",":n=new i,h.parent.addChild(n),h=n;break;case";":break;default:const a=r(t.slice(e)),o=e+a.length,c=":"===t[o]?parseLength(t.slice(o+1)):0;h.length=parseFloat(c),h.label=a,h.id=a.trim()||i.generateId(),e=o+String(c).length}}},parse:({str:t,root:e},s)=>(function({string:t,root:e},s){let h=t.replace(/(\r|\n)/g,""),n=e;for(let t=0;t<h.length;t++){let e;switch(h[t]){case"(":e=new i,n.addChild(e),n=e;break;case")":n=n.parent;break;case",":e=new i,n.parent.addChild(e),n=e;break;case";":break;default:try{t=o(n,h,t)}catch(t){return s(t)}}}return s()})({string:t,root:e},s)};function l(t){return t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||1}e.default=class{constructor(t,e,s={}){this.container="string"==typeof t?document.querySelector(t):t;const i=document.createElement("canvas");i.width=this.container.offsetWidth||400,i.height=this.container.offsetHeight||400,this.ctx=i.getContext("2d"),this.container.appendChild(i),this.startX=null,this.startY=null,this.offsetX=this.ctx.canvas.width/2,this.offsetY=this.ctx.canvas.height/2,this.totalChildren=0,this.branches={},this.leaves=[],this.root=!1,this.maxBranchLength=0,this.farthestNodeFromRootX=0,this.farthestNodeFromRootY=0,this.baseNodeSize=10,this.padding=50,this.labelPadding=25,this.fSize=20,this.font=`${this.fSize}pt sans-serif`,this.lineWidth=2,this.setSize(this.container.offsetWidth,this.container.offsetHeight)}setSize(t,e){this.ctx.canvas.width=t,this.ctx.canvas.height=e;const s=window.devicePixelRatio/l(this.ctx);this.ctx.canvas.style.height=`${this.ctx.canvas.height}px`,this.ctx.canvas.style.width=`${this.ctx.canvas.width}px`,s>1&&(this.ctx.canvas.width*=s,this.ctx.canvas.height*=s)}init(t){this.str=t.replace(/\s/g,""),i.lastId=0;const e=new i;e.id="root",e.tree=this,this.branches.root=e,this.root=e,c.parse({str:this.str,root:this.root},()=>{this.storeNode(this.root),this.root.storeChildren(),this.root.length=0,this.maxLength=0,this.root.setTotalLength(),this.draw(),window.addEventListener("resize",()=>{this.setSize(this.container.offsetWidth,this.container.offsetHeight),this.draw()})})}drawBranch(t){const e=t.length*this.getScale();t.angle=0,t.parent&&(t.centerX=t.startX+e),this.ctx.beginPath(),this.ctx.moveTo(t.startX,t.startY),this.ctx.lineTo(t.startX,t.centerY),this.ctx.lineTo(t.centerX,t.centerY),this.ctx.stroke(),this.ctx.closePath(),t.drawNode(),t.children.forEach(e=>{e.startX=t.centerX,e.startY=t.centerY,this.drawBranch(e)})}storeNode(t){t.id||(t.id=i.generateId()),this.branches[t.id]=t,t.leaf&&this.leaves.push(t)}getStep(){return this.ctx.canvas.height/this.leaves.length+this.labelPadding}getScale(){return this.ctx.canvas.width/this.maxBranchLength}calculate(t){const e=this.getScale();this.leaves.forEach((s,i)=>{s.angle=0,s.centerY=i>0?this.leaves[i-1].centerY+t:0,s.centerX=this.leaves[i].totalLength*e,s.centerX>this.farthestNodeFromRootX&&(this.farthestNodeFromRootX=s.centerX),s.centerY>this.farthestNodeFromRootY&&(this.farthestNodeFromRootY=s.centerY);for(let t=s;t.parent;t=t.parent)t.parent.centerY=(t.parent.children[0].centerY+t.parent.children[t.parent.children.length-1].centerY)/2})}getNumLeaves(t){let e=0;const s=[t];for(;s.length;)s.pop().children.forEach(t=>{t.children.length?s.push(t):e+=1});return e}scaleBranchLengths(t,e){return t/e*this.ctx.canvas.width/2}scaleBranchHeights(t,e){return t/e*this.ctx.canvas.height}getBounds(t=this.leaves){const{startX:e,startY:s}=t===this.leaves?this.root:t[0];return t.reduce((t,e)=>{const{minX:s,maxX:i,minY:h,maxY:n}=e.getBounds();return t.minX=Math.min(t.minX,s),t.maxX=Math.max(t.maxX,i),t.minY=Math.min(t.minY,h),t.maxY=Math.max(t.maxY,n),t},{minX:e,maxX:e,minY:s,maxY:s})}draw(){this.zoom=1;const t=this.getStep();this.root.startX=0,this.root.startY=0,this.root.centerX=0,this.root.centerY=0,this.farthestNodeFromRootX=0,this.farthestNodeFromRootY=0,this.calculate(t),this.root.startX=this.root.centerX,this.root.startY=this.root.centerY,this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.strokeStyle="blue",this.ctx.save();const{minX:e,maxX:s,minY:i,maxY:h}=this.getBounds(),{width:n,height:r}=this.ctx.canvas,a=[n-2*this.padding,r-2*this.padding],o=[s-e,h-i];console.log(h);const c=window.devicePixelRatio/l(this.ctx),d=a[0]/o[0],f=a[1]/o[1];this.zoom=Math.min(d,f),this.offsetX=-1*e*this.zoom,this.offsetY=-1*i*this.zoom,d>f?(this.offsetX+=this.padding+(a[0]-o[0]*this.zoom)/2,this.offsetY+=this.padding):(this.offsetX+=this.padding,this.offsetY+=this.padding+(a[1]-o[1]*this.zoom)/2),this.offsetX=this.offsetX/c,this.offsetY=this.offsetY/c,this.ctx.lineWidth=this.lineWidth/this.zoom,this.ctx.translate(this.offsetX*c,this.offsetY*c),this.ctx.scale(this.zoom,this.zoom),this.drawBranch(this.root),this.ctx.restore()}}}]).default;